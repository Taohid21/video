<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tic-Tac-Toe Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg: #18191a; --card: #242526; --text: #e4e6eb; --text-sec: #b0b3b8;
            --accent: #2d88ff; --border: #3e4042; --input: #3a3b3c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Top Bar */
        .top-bar { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; background: var(--card); border-bottom: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;}
        .leave-btn { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.3); padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .leave-btn:active { transform: scale(0.95); background: #e74c3c; color: white; }

        /* Game Area */
        .game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .turn-indicator { font-size: 20px; font-weight: 700; margin-bottom: 30px; background: var(--card); padding: 10px 20px; border-radius: 20px; border: 1px solid var(--accent); color: var(--text); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .turn-indicator span { color: var(--accent); }
        
        /* Board */
        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 90%; max-width: 320px; }
        .cell { width: 100%; aspect-ratio: 1; background: var(--card); border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 60px; font-weight: 800; cursor: pointer; box-shadow: 0 6px 12px rgba(0,0,0,0.2); transition: 0.2s; border: 2px solid var(--border); }
        .cell:active { transform: scale(0.95); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .cell.x { color: #ff4757; text-shadow: 0 0 15px rgba(255, 71, 87, 0.4); }
        .cell.o { color: #2ed573; text-shadow: 0 0 15px rgba(46, 213, 115, 0.4); }

        /* Player Stats (Bottom Bar) */
        .player-bar { height: 90px; background: var(--card); border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 10; padding-bottom: 15px; }
        .player { display: flex; align-items: center; gap: 10px; width: 35%; }
        .p-img-box { position: relative; }
        .p-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 3px solid; background: #333;}
        .p-img.x-player { border-color: #ff4757; }
        .p-img.o-player { border-color: #2ed573; }
        .p-name { font-weight: 700; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }
        .p-score { font-size: 12px; color: var(--text-sec); font-weight: 600; margin-top: 2px; }

        /* Mic Button */
        .mic-btn { width: 55px; height: 55px; border-radius: 50%; background: var(--input); display: flex; justify-content: center; align-items: center; font-size: 22px; color: var(--text-sec); cursor: pointer; border: none; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 20; margin-top: -30px; border: 3px solid var(--card); }
        .mic-btn.active { background: #ff4757; color: white; box-shadow: 0 0 20px rgba(255, 71, 87, 0.6); animation: micPulse 1.5s infinite; border-color: #ff4757; }

        @keyframes micPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 71, 87, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); } }

        /* Loading / Winner Overlay */
        .overlay-msg { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 50; display: none; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .win-text { font-size: 40px; font-weight: 800; color: white; text-shadow: 0 4px 10px rgba(0,0,0,0.5); margin-bottom: 20px; text-align: center;}
        .rematch-btn { background: var(--accent); color: white; border: none; padding: 12px 25px; border-radius: 30px; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(45, 136, 255, 0.4); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div style="font-weight: 700; font-size: 18px; color: var(--text);"><i class="fas fa-gamepad" style="color:var(--accent); margin-right:5px;"></i> Tic-Tac-Toe</div>
        <button class="leave-btn" onclick="leaveGame()">Leave</button>
    </div>

    <div class="game-area">
        <div id="turn-txt" class="turn-indicator">Waiting for <span>Opponent...</span></div>
        
        <div class="board" id="board">
            <div class="cell" onclick="makeMove(0)"></div>
            <div class="cell" onclick="makeMove(1)"></div>
            <div class="cell" onclick="makeMove(2)"></div>
            <div class="cell" onclick="makeMove(3)"></div>
            <div class="cell" onclick="makeMove(4)"></div>
            <div class="cell" onclick="makeMove(5)"></div>
            <div class="cell" onclick="makeMove(6)"></div>
            <div class="cell" onclick="makeMove(7)"></div>
            <div class="cell" onclick="makeMove(8)"></div>
        </div>

        <!-- Result Overlay -->
        <div id="result-overlay" class="overlay-msg">
            <div id="result-text" class="win-text">You Win! ðŸŽ‰</div>
            <button class="rematch-btn" onclick="requestRematch()"><i class="fas fa-redo"></i> Play Again</button>
        </div>
    </div>

    <div class="player-bar">
        <!-- You (Player 1) -->
        <div class="player">
            <div class="p-img-box"><img id="my-img" src="https://via.placeholder.com/45" class="p-img x-player"></div>
            <div>
                <div id="my-name" class="p-name">You</div>
                <div class="p-score">X <span style="margin:0 4px;">â€¢</span> <span id="my-pts">0</span> pts</div>
            </div>
        </div>

        <!-- Voice Chat Mic -->
        <button class="mic-btn" id="mic-btn" onclick="toggleMic()">
            <i class="fas fa-microphone-slash"></i>
        </button>

        <!-- Opponent (Player 2) -->
        <div class="player" style="flex-direction: row-reverse; text-align: right;">
            <div class="p-img-box"><img id="opp-img" src="https://via.placeholder.com/45" class="p-img o-player"></div>
            <div>
                <div id="opp-name" class="p-name">Opponent</div>
                <div class="p-score"><span id="opp-pts">0</span> pts <span style="margin:0 4px;">â€¢</span> O</div>
            </div>
        </div>
    </div>

    <script type="module">
        // ==========================================
        // UI & INTERACTION LOGIC (Without Database yet)
        // ==========================================
        
        // 1. Leave Game Button (Send message to index.html to close iframe)
        window.leaveGame = () => {
            if(confirm("Are you sure you want to leave the game?")) {
                window.parent.postMessage("leave_game", "*");
            }
        };

        // 2. Microphone Toggle (Visual only for now)
        let isMicOn = false;
        window.toggleMic = () => {
            isMicOn = !isMicOn;
            const btn = document.getElementById('mic-btn');
            btn.classList.toggle('active', isMicOn);
            btn.innerHTML = isMicOn ? '<i class="fas fa-microphone"></i>' : '<i class="fas fa-microphone-slash"></i>';
        };

        // 3. Simple Tic-Tac-Toe Move Logic (To test if board works)
        let currentTurn = 'X'; 
        
        window.makeMove = (index) => {
            const cells = document.querySelectorAll('.cell');
            
            // If cell is empty
            if (!cells[index].innerText) {
                // Add X or O
                cells[index].innerText = currentTurn;
                cells[index].classList.add(currentTurn.toLowerCase());
                
                // Change turn
                currentTurn = currentTurn === 'X' ? 'O' : 'X';
                
                // Update text
                const turnTxt = document.getElementById('turn-txt');
                if(currentTurn === 'X') {
                    turnTxt.innerHTML = "Your Turn (<span>X</span>)";
                } else {
                    turnTxt.innerHTML = "Opponent's Turn (<span>O</span>)";
                }
            }
        };

        // 4. Rematch Button Test
        window.requestRematch = () => {
            document.getElementById('result-overlay').style.display = 'none';
            document.querySelectorAll('.cell').forEach(c => {
                c.innerText = '';
                c.classList.remove('x', 'o');
            });
            currentTurn = 'X';
            document.getElementById('turn-txt').innerHTML = "Your Turn (<span>X</span>)";
        };
    </script>
</body>
</html>
