<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>tio</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #f0f2f5; padding-top: 105px; padding-bottom: 60px; min-height: 100vh; overscroll-behavior-y: contain; }

        .hidden { display: none !important; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; backdrop-filter: blur(2px); }
        
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.4s; }
        .splash-logo { font-size: 50px; font-weight: 800; color: #1877f2; letter-spacing: -2px; }
        .splash-spinner { margin-top: 20px; width: 30px; height: 30px; border: 3px solid #ddd; border-top-color: #1877f2; border-radius: 50%; animation: spin 0.8s infinite linear; }

        .header { position: fixed; top: 0; left: 0; width: 100%; height: 55px; background: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 1000; border-bottom: 1px solid #ddd; }
        .logo { font-size: 28px; font-weight: 800; color: #1877f2; }
        .header-icons i { font-size: 18px; background: #f0f2f5; width: 35px; height: 35px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-left: 8px; color: #050505; }

        .nav-tabs { position: fixed; top: 55px; left: 0; width: 100%; height: 50px; background: #fff; display: flex; align-items: center; z-index: 999; border-bottom: 1px solid #ccc; }
        .tab { flex: 1; height: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; }
        .tab i { font-size: 24px; color: #65676b; }
        .tab.active i { color: #1877f2; }
        .tab.active::after { content: ''; position: absolute; bottom: 0; width: 100%; height: 3px; background: #1877f2; }

        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.3s; }

        .create-box { background: #fff; padding: 12px 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; }
        .u-avatar { width: 40px; height: 40px; border-radius: 50%; background: #eee; object-fit: cover; }
        .c-input { flex: 1; background: #f0f2f5; height: 40px; border-radius: 20px; padding: 0 15px; display: flex; align-items: center; color: #65676b; font-size: 15px; border: 1px solid #ddd; }

        .story-tray { background: #fff; padding: 15px 10px; margin-bottom: 10px; overflow-x: auto; display: flex; gap: 8px; scrollbar-width: none; border-bottom: 1px solid #ddd; }
        .story-card { min-width: 110px; height: 190px; border-radius: 12px; position: relative; overflow: hidden; background: #f0f2f5; border: 1px solid #ddd; flex-shrink: 0; }
        .story-card img { width: 100%; height: 100%; object-fit: cover; }
        .story-user { position: absolute; bottom: 5px; left: 5px; color: #fff; font-size: 12px; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.8); }
        .story-overlay-btn { position: absolute; bottom: 0; width: 100%; height: 50px; background: #fff; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 5px; font-weight: 600; font-size: 13px; }
        .s-plus { position: absolute; bottom: 30px; background: #1877f2; color: #fff; width: 32px; height: 32px; border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .post { background: #fff; margin-bottom: 10px; width: 100%; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; }
        .post-head { padding: 12px 15px; display: flex; align-items: center; gap: 10px; }
        .p-info h4 { font-size: 16px; font-weight: 600; color: #050505; }
        .p-info span { font-size: 12px; color: #65676b; }
        .p-text { font-size: 15px; color: #050505; line-height: 1.4; padding: 0 15px 10px; }
        .p-media { width: 100%; background: #000; display: block; overflow: hidden; }
        .p-media img, .p-media video { width: 100%; max-height: 600px; object-fit: contain; display: block; }
        .p-stats { padding: 10px 15px; display: flex; justify-content: space-between; border-bottom: 1px solid #f0f2f5; color: #65676b; font-size: 13px; }
        .p-actions { display: flex; height: 44px; align-items: center; }
        .act-btn { flex: 1; display: flex; align-items: center; justify-content: center; height: 100%; color: #65676b; font-weight: 600; font-size: 14px; gap: 6px; }
        .act-btn:active { background: #f2f2f2; }
        .act-btn.liked { color: #1877f2; }

        /* MODALS (Action Sheets) */
        .sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-radius: 15px 15px 0 0; z-index: 2500; transform: translateY(100%); transition: transform 0.3s; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); max-height: 80vh; display: flex; flex-direction: column; }
        .sheet.open { transform: translateY(0); }
        .sheet-head { padding: 15px; text-align: center; border-bottom: 1px solid #eee; position: relative; font-weight: 700; font-size: 16px; }
        .sheet-close { position: absolute; right: 15px; top: 15px; background: #eee; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .sheet-body { padding: 15px; overflow-y: auto; }

        /* Share Options */
        .share-opt { display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 8px; margin-bottom: 5px; }
        .share-opt:active { background: #f0f2f5; }
        .share-opt i { font-size: 22px; width: 40px; height: 40px; border-radius: 50%; background: #e4e6eb; display: flex; align-items: center; justify-content: center; }

        /* Comments */
        .cmt-input-area { display: flex; gap: 10px; padding: 10px; border-top: 1px solid #eee; }
        .cmt-box { flex: 1; background: #f0f2f5; border: none; padding: 10px 15px; border-radius: 20px; outline: none; }
        .cmt-send { color: #1877f2; font-weight: 600; padding: 10px; cursor: pointer; }
        .cmt-list { flex: 1; overflow-y: auto; padding: 10px; }
        .cmt-item { display: flex; gap: 10px; margin-bottom: 15px; }
        .cmt-bubble { background: #f0f2f5; padding: 8px 12px; border-radius: 15px; }
        .cmt-name { font-weight: 700; font-size: 13px; color: #050505; }
        .cmt-txt { font-size: 14px; color: #050505; }

        /* Story Viewer (Full Screen) */
        #story-viewer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; }
        .sv-progress { height: 3px; background: rgba(255,255,255,0.3); width: 95%; margin: 10px auto; border-radius: 2px; }
        .sv-bar { height: 100%; background: #fff; width: 0%; transition: width 0.1s linear; }
        .sv-header { padding: 10px 15px; display: flex; align-items: center; gap: 10px; color: #fff; }
        .sv-img { flex: 1; width: 100%; object-fit: contain; }
        .sv-caption { position: absolute; bottom: 100px; left: 0; width: 100%; text-align: center; color: #fff; font-weight: 700; text-shadow: 0 1px 5px rgba(0,0,0,0.8); font-size: 18px; padding: 20px; }
        
        /* Story Upload Preview */
        #story-preview-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 4000; display: none; flex-direction: column; }
        .sp-img-con { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .sp-img { max-width: 100%; max-height: 80vh; }
        .sp-caption-inp { position: absolute; bottom: 20%; background: rgba(0,0,0,0.5); border: none; color: white; padding: 10px; text-align: center; font-size: 18px; outline: none; width: 80%; border-radius: 8px; }

        /* Video Feed */
        .video-reel { height: calc(100vh - 110px); background: #000; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; border-bottom: 1px solid #333; }
        .video-reel video { width: 100%; height: 100%; object-fit: cover; }
        .reel-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 20px; color: #fff; }

        /* Suggestion Card */
        .sugg-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 10px 15px; background: #fff; margin-bottom: 10px; }
        .sugg-card { min-width: 150px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; text-align: center; }
        .sugg-img { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; object-fit: cover; }
        .sugg-btn { background: #e7f3ff; color: #1877f2; border: none; width: 100%; padding: 6px; border-radius: 6px; font-weight: 600; margin-top: 5px; font-size: 13px; }

        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="splash-screen"><div class="splash-logo">tio</div><div class="splash-spinner"></div></div>
    
    <!-- Action Sheet Overlay -->
    <div id="sheet-overlay" class="overlay hidden" onclick="closeSheets()"></div>

    <!-- Header -->
    <div class="header">
        <div class="logo" onclick="window.location.reload()">tio</div>
        <div class="header-icons">
            <i class="fas fa-plus" onclick="document.getElementById('postInp').click()"></i>
            <i class="fas fa-search"></i>
            <i class="fas fa-bars" onclick="logoutApp()"></i>
        </div>
    </div>

    <!-- Tabs -->
    <div class="nav-tabs">
        <div class="tab active" id="t-home" onclick="nav('home')"><i class="fas fa-home"></i></div>
        <div class="tab" id="t-video" onclick="nav('video')"><i class="fas fa-video"></i></div>
        <div class="tab" id="t-friends" onclick="nav('friends')"><i class="fas fa-user-friends"></i></div>
        <div class="tab" id="t-profile" onclick="nav('profile')"><i class="fas fa-user-circle"></i></div>
    </div>

    <!-- HOME -->
    <div id="p-home" class="page-section active">
        <div class="create-box">
            <img id="my-ava" class="u-avatar">
            <div class="c-input" onclick="window.location.href='post.html'">What's on your mind?</div>
            <i class="fas fa-images" style="color: #45bd62; font-size: 20px;"></i>
        </div>

        <div class="story-tray" id="story-tray">
            <div class="story-card" onclick="document.getElementById('s-up').click()">
                <img id="my-s-pic" src="https://via.placeholder.com/150">
                <div class="story-overlay-btn">Create Story</div>
                <div class="s-plus">+</div>
                <input type="file" id="s-up" hidden accept="image/*" onchange="previewStory(this)">
            </div>
        </div>

        <div id="feed">
            <div style="padding:40px; text-align:center; color:#888;">Loading Feed...</div>
        </div>
    </div>

    <!-- VIDEO -->
    <div id="p-video" class="page-section" style="background: black; min-height: 100vh;">
        <div id="v-feed"></div>
    </div>

    <!-- FRIENDS -->
    <div id="p-friends" class="page-section">
        <div style="padding:15px; font-weight:700; background:#fff;">Friend Requests</div>
        <div id="req-list"></div>
        <div style="padding:15px; font-weight:700; background:#fff; margin-top:10px;">People You May Know</div>
        <div class="sugg-scroller" id="sugg-list"></div>
    </div>

    <!-- PROFILE -->
    <div id="p-profile" class="page-section">
        <div style="background:#fff; text-align:center; padding-bottom:15px; margin-bottom:10px;">
            <img id="pf-cover" style="width:100%; height:180px; object-fit:cover; background:#ddd;">
            <img id="pf-pic" style="width:110px; height:110px; border-radius:50%; border:4px solid white; margin-top:-55px; background:#eee; object-fit:cover;">
            <h2 id="pf-name" style="margin-top:10px; font-size:24px;"></h2>
            <button style="margin-top:10px; background:#e4e6eb; border:none; padding:8px 20px; font-weight:600; border-radius:6px;">Edit Profile</button>
        </div>
        <div id="my-posts"></div>
    </div>

    <!-- SHARE SHEET -->
    <div id="share-sheet" class="sheet">
        <div class="sheet-head">Share to<div class="sheet-close" onclick="closeSheets()"><i class="fas fa-times"></i></div></div>
        <div class="sheet-body">
            <div class="share-opt" onclick="shareNow()"><i class="fas fa-share-square" style="color:#1877f2"></i> Share to Feed</div>
            <div class="share-opt" onclick="copyLnk()"><i class="fas fa-link" style="color:#000"></i> Copy Link</div>
        </div>
    </div>

    <!-- COMMENT SHEET -->
    <div id="cmt-sheet" class="sheet" style="height: 70vh;">
        <div class="sheet-head">Comments<div class="sheet-close" onclick="closeSheets()"><i class="fas fa-times"></i></div></div>
        <div class="cmt-list" id="cmt-list"></div>
        <div class="cmt-input-area">
            <input type="text" class="cmt-box" id="cmt-inp" placeholder="Write a comment...">
            <div class="cmt-send" onclick="postCmt()">Send</div>
        </div>
    </div>

    <!-- STORY PREVIEW MODAL -->
    <div id="story-preview-modal">
        <div style="padding:15px; color:white; display:flex; justify-content:space-between;">
            <span onclick="closeStoryPrev()">Cancel</span>
            <span style="font-weight:bold" onclick="uploadStoryFinal()">Share</span>
        </div>
        <div class="sp-img-con">
            <img id="sp-img-src" class="sp-img">
            <input type="text" id="sp-txt" class="sp-caption-inp" placeholder="Add a caption...">
        </div>
    </div>

    <!-- STORY VIEWER -->
    <div id="story-viewer">
        <div class="sv-progress"><div class="sv-bar" id="sv-bar"></div></div>
        <div class="sv-header">
            <img id="sv-u-pic" style="width:35px; height:35px; border-radius:50%;">
            <span id="sv-u-name" style="font-weight:600;"></span>
            <div style="flex:1"></div>
            <i class="fas fa-times" onclick="closeStoryView()" style="font-size:20px; padding:10px;"></i>
        </div>
        <img id="sv-main-img" class="sv-img">
        <div id="sv-caption" class="sv-caption"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, query, orderBy, limit, getDocs, updateDoc, arrayUnion, arrayRemove, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const cfg = { apiKey: "AIzaSyD_HBGuQSh_GzqrHqHbgdaoBikLZsK3Qqs", authDomain: "new-all-f99f7.firebaseapp.com", projectId: "new-all-f99f7", storageBucket: "new-all-f99f7.appspot.com", messagingSenderId: "1069748173900", appId: "1:1069748173900:web:158d6336c0f4628133c8e9" };
        const CLOUD_URL = "https://api.cloudinary.com/v1_1/dwgvvzbvn/auto/upload";
        const PRESET = "storyapp";

        const app = initializeApp(cfg);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let curUser = null;
        let activePostId = null;
        let tempStoryFile = null;

        onAuthStateChanged(auth, async (u) => {
            const splash = document.getElementById('splash-screen');
            if(u) {
                curUser = u;
                const d = (await getDoc(doc(db,"users",u.uid))).data();
                if(d) {
                    ['my-ava','my-s-pic','pf-pic'].forEach(i => document.getElementById(i).src = d.profilePic);
                    document.getElementById('pf-cover').src = d.coverPic;
                    document.getElementById('pf-name').innerText = d.fullName;
                    initApp();
                }
                splash.style.opacity = '0';
                setTimeout(()=>splash.style.display='none',400);
            } else window.location.href="Account.html";
        });

        function initApp() {
            loadFeed(); loadStories(); loadSugg(); loadReq();
        }

        window.nav = (p) => {
            document.querySelectorAll('.page-section').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
            document.getElementById('p-'+p).classList.add('active');
            document.getElementById('t-'+p).classList.add('active');
            if(p==='video') loadVideos();
            if(p==='profile') loadMyPosts();
        }

        // --- FEED ---
        async function loadFeed() {
            const c = document.getElementById('feed');
            const q = query(collection(db,"posts"), orderBy("timestamp","desc"), limit(20));
            const s = await getDocs(q);
            let h = "";
            s.forEach(d => h += htmlPost(d.data(), d.id));
            c.innerHTML = h;
        }

        function htmlPost(p, id) {
            const liked = p.likes?.includes(curUser.uid) ? 'liked' : '';
            const nLike = p.likes?.length || 0;
            let m = "";
            if(p.mediaUrl) m = p.type==='video' ? `<div class="p-media"><video src="${p.mediaUrl}" controls></video></div>` : `<div class="p-media"><img src="${p.mediaUrl}"></div>`;
            return `<div class="post">
                <div class="post-head"><img src="${p.userPic}" class="u-avatar"><div class="p-info"><h4>${p.userName}</h4><span>Just now</span></div></div>
                <div class="p-text">${p.text}</div>${m}
                <div class="p-stats"><span>${nLike} Likes</span><span>Comments</span></div>
                <div class="p-actions">
                    <div class="act-btn ${liked}" id="l-${id}" onclick="doLike('${id}')"><i class="fas fa-thumbs-up"></i> Like</div>
                    <div class="act-btn" onclick="openCmt('${id}')"><i class="far fa-comment-alt"></i> Comment</div>
                    <div class="act-btn" onclick="openShare('${id}')"><i class="fas fa-share"></i> Share</div>
                </div>
            </div>`;
        }

        window.doLike = async(id) => {
            const b = document.getElementById(`l-${id}`);
            if(b.classList.contains('liked')) {
                b.classList.remove('liked');
                updateDoc(doc(db,"posts",id), {likes:arrayRemove(curUser.uid)});
            } else {
                b.classList.add('liked');
                updateDoc(doc(db,"posts",id), {likes:arrayUnion(curUser.uid)});
            }
        }

        // --- SHARE ---
        window.openShare = (id) => {
            activePostId = id;
            document.getElementById('sheet-overlay').classList.remove('hidden');
            document.getElementById('share-sheet').classList.add('open');
        }
        window.closeSheets = () => {
            document.getElementById('sheet-overlay').classList.add('hidden');
            document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open'));
        }
        window.copyLnk = () => {
            navigator.clipboard.writeText("https://tio.app/post/"+activePostId);
            alert("Link Copied!"); closeSheets();
        }
        window.shareNow = async () => {
            alert("Shared to your timeline!"); closeSheets();
        }

        // --- COMMENTS ---
        window.openCmt = async (id) => {
            activePostId = id;
            document.getElementById('sheet-overlay').classList.remove('hidden');
            document.getElementById('cmt-sheet').classList.add('open');
            loadCmts(id);
        }
        async function loadCmts(pid) {
            const list = document.getElementById('cmt-list');
            list.innerHTML = "Loading...";
            const s = await getDocs(collection(db,"posts",pid,"comments"));
            let h = "";
            s.forEach(d => {
                const c = d.data();
                h += `<div class="cmt-item"><img src="${c.uPic}" class="u-avatar"><div class="cmt-bubble"><div class="cmt-name">${c.uName}</div><div class="cmt-txt">${c.txt}</div></div></div>`;
            });
            list.innerHTML = h || "<div style='text-align:center;padding:20px;color:#999'>No comments yet</div>";
        }
        window.postCmt = async () => {
            const txt = document.getElementById('cmt-inp').value;
            if(!txt) return;
            const u = (await getDoc(doc(db,"users",curUser.uid))).data();
            await addDoc(collection(db,"posts",activePostId,"comments"), {
                uid: curUser.uid, uName: u.fullName, uPic: u.profilePic, txt: txt, time: serverTimestamp()
            });
            document.getElementById('cmt-inp').value = "";
            loadCmts(activePostId);
        }

        // --- STORY ---
        window.previewStory = (inp) => {
            if(inp.files[0]) {
                tempStoryFile = inp.files[0];
                document.getElementById('sp-img-src').src = URL.createObjectURL(tempStoryFile);
                document.getElementById('story-preview-modal').style.display = 'flex';
            }
        }
        window.closeStoryPrev = () => document.getElementById('story-preview-modal').style.display = 'none';
        
        window.uploadStoryFinal = async () => {
            const cap = document.getElementById('sp-txt').value;
            const btn = document.querySelector('#story-preview-modal span:last-child');
            btn.innerText = "Posting...";
            
            const fd = new FormData(); fd.append('file', tempStoryFile); fd.append('upload_preset', PRESET);
            try {
                const res = await fetch(CLOUD_URL, {method:'POST', body:fd});
                const d = await res.json();
                const u = (await getDoc(doc(db,"users",curUser.uid))).data();
                await addDoc(collection(db,"stories"), {
                    uid: curUser.uid, url: d.secure_url, userName: u.fullName, userPic: u.profilePic, caption: cap, timestamp: new Date().toISOString()
                });
                closeStoryPrev(); loadStories();
            } catch(e) { alert("Fail"); btn.innerText="Share"; }
        }

        async function loadStories() {
            const t = document.getElementById('story-tray');
            const q = query(collection(db,"stories"), orderBy("timestamp","desc"), limit(15));
            const s = await getDocs(q);
            while(t.children.length>1) t.removeChild(t.lastChild);
            s.forEach(d => {
                const st = d.data();
                const div = document.createElement('div');
                div.className = 'story-card';
                div.innerHTML = `<img src="${st.url}"><div class="story-user">${st.userName}</div>`;
                div.onclick = () => viewStory(st);
                t.appendChild(div);
            });
        }
        
        window.viewStory = (s) => {
            const v = document.getElementById('story-viewer');
            document.getElementById('sv-main-img').src = s.url;
            document.getElementById('sv-u-pic').src = s.userPic;
            document.getElementById('sv-u-name').innerText = s.userName;
            document.getElementById('sv-caption').innerText = s.caption || "";
            v.style.display = 'flex';
            
            const bar = document.getElementById('sv-bar');
            bar.style.width = '0%';
            setTimeout(() => bar.style.width = '100%', 100);
            setTimeout(() => v.style.display = 'none', 5000); // 5 sec auto close
        }
        window.closeStoryView = () => document.getElementById('story-viewer').style.display = 'none';

        // --- FRIENDS & SUGGESTIONS ---
        async function loadReq() {
            const c = document.getElementById('req-list');
            const u = (await getDoc(doc(db,"users",curUser.uid))).data();
            c.innerHTML = "";
            if(u.friendRequests?.length) {
                u.friendRequests.forEach(async id => {
                    const f = (await getDoc(doc(db,"users",id))).data();
                    c.innerHTML += `<div style="padding:10px; border-bottom:1px solid #eee; display:flex; align-items:center; gap:10px;">
                        <img src="${f.profilePic}" style="width:50px; height:50px; border-radius:50%;">
                        <div style="flex:1"><b>${f.fullName}</b><br><button onclick="ansReq('${id}',true)" style="background:#1877f2; color:white; border:none; padding:5px 10px; border-radius:4px; margin-top:5px;">Confirm</button></div>
                    </div>`;
                });
            } else c.innerHTML = "<div style='padding:15px; color:#888'>No requests</div>";
        }
        async function loadSugg() {
            const c = document.getElementById('sugg-list');
            const s = await getDocs(collection(db,"users"));
            const me = (await getDoc(doc(db,"users",curUser.uid))).data();
            c.innerHTML = "";
            s.forEach(d => {
                const u = d.data();
                if(u.uid !== curUser.uid && !me.friends?.includes(u.uid)) {
                    c.innerHTML += `<div class="sugg-card">
                        <img src="${u.profilePic}" class="sugg-img">
                        <div style="font-weight:600; font-size:14px; margin-bottom:5px; height:35px; overflow:hidden;">${u.fullName}</div>
                        <button class="sugg-btn" onclick="sndReq('${u.uid}',this)">Add Friend</button>
                    </div>`;
                }
            });
        }
        window.ansReq = async (id, y) => {
            if(y) {
                await updateDoc(doc(db,"users",curUser.uid), {friendRequests:arrayRemove(id), friends:arrayUnion(id)});
                await updateDoc(doc(db,"users",id), {friends:arrayUnion(curUser.uid)});
                loadReq();
            }
        }
        window.sndReq = async (id, btn) => {
            btn.innerText = "Sent"; btn.disabled = true;
            await updateDoc(doc(db,"users",id), {friendRequests:arrayUnion(curUser.uid)});
        }

        // --- VIDEO & MY POSTS ---
        async function loadVideos() {
            const c = document.getElementById('v-feed');
            if(c.children.length) return;
            const s = await getDocs(query(collection(db,"posts"), orderBy("timestamp","desc")));
            s.forEach(d => {
                const p = d.data();
                if(p.type==='video') c.innerHTML += `<div class="video-reel"><video src="${p.mediaUrl}" loop onclick="this.paused?this.play():this.pause()"></video><div class="reel-overlay"><b>${p.userName}</b><br>${p.text}</div></div>`;
            });
        }
        async function loadMyPosts() {
            const c = document.getElementById('my-posts');
            const s = await getDocs(query(collection(db,"posts"), orderBy("timestamp","desc")));
            let h = "";
            s.forEach(d => { if(d.data().uid===curUser.uid) h+=htmlPost(d.data(),d.id); });
            c.innerHTML = h;
        }

        window.logoutApp = () => signOut(auth).then(()=>window.location.href="Account.html");

    </script>
</body>
</html>
